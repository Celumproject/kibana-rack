<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>kibana-rack by tabolario</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">kibana-rack</h1>
        <p class="header">Embed Kibana as a Rack application</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/tabolario/kibana-rack/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/tabolario/kibana-rack/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/tabolario/kibana-rack">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/tabolario">tabolario</a></p>


      </header>
      <section>
        <p><a href="http://www.elasticsearch.org/overview/kibana/"><img src="https://img.shields.io/badge/kibana%20version-3.1.0-orange.svg" alt="Kibana Version"></a>
<a href="https://rubygems.org/gems/kibana-rack"><img src="https://img.shields.io/gem/v/kibana-rack.svg" alt="Gem Version"></a>
<a href="https://gemnasium.com/tabolario/kibana-rack"><img src="https://gemnasium.com/tabolario/kibana-rack.svg" alt="Dependency Status"></a>
<a href="https://travis-ci.org/tabolario/kibana-rack"><img src="https://travis-ci.org/tabolario/kibana-rack.svg?branch=master" alt="Build Status"></a>
<a href="https://codeclimate.com/github/tabolario/kibana-rack"><img src="https://img.shields.io/codeclimate/github/tabolario/kibana-rack.svg" alt="Code Climate"></a>
<a href="https://coveralls.io/r/tabolario/kibana-rack?branch=master"><img src="https://img.shields.io/coveralls/tabolario/kibana-rack.svg" alt="Coverage Status"></a>
<a href="http://inch-ci.org/github/tabolario/kibana-rack"><img src="http://inch-ci.org/github/tabolario/kibana-rack.svg" alt="Inline docs"></a></p>

<p>Embed <a href="http://www.elasticsearch.org/overview/kibana/">Kibana</a> as a <a href="http://rack.github.io/">Rack</a> application.</p>

<p>From the <a href="https://github.com/elasticsearch/kibana/blob/master/README.md">Kibana readme</a>:</p>

<blockquote>
<p>Kibana is an open source (Apache Licensed), browser based analytics and search interface to Logstash and other timestamped data sets stored in ElasticSearch. With those in place Kibana is a snap to setup and start using (seriously). Kibana strives to be easy to get started with, while also being flexible and powerful</p>
</blockquote>

<p>kibana-rack tracks the latest version of Kibana (currently 3.1.0) and embeds it directly in your application, along with a proxy for the Elasticsearch API endpoints that Kibana needs.</p>

<p><a href="http://www.elasticsearch.org/guide/en/kibana/current/_dashboard_schema.html">Kibana dashboards</a> can be created using ERB-processed JSON files in the directory specified by your kibana-rack configuration.</p>

<h2>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li>Ruby 2.1+ (kibana-rack is developed and tested with Ruby 2.1.2)</li>
</ul><h3>
<a name="kibana-requirements-also-from-the-kibana-readme" class="anchor" href="#kibana-requirements-also-from-the-kibana-readme"><span class="octicon octicon-link"></span></a>Kibana requirements (also from the Kibana readme)</h3>

<ul>
<li>Elasticsearch 0.90.9 or above</li>
<li>A modern web browser. The latest version of Chrome, Safari and Firefox have all been tested to work. IE9 and greater should work. IE8 does not.</li>
<li>A webserver. No extensions are required, as long as it can serve plain html it will work</li>
<li>A browser reachable Elasticsearch server. Port 9200 must be open, or a proxy configured to allow access to it. (<strong>kibana-rack takes care of this for you!</strong>)</li>
</ul><h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Add this line to your application's Gemfile:</p>

<pre><code>gem 'kibana-rack', '~&gt; 0.1.0'
</code></pre>

<p>And then execute:</p>

<pre><code>$ bundle
</code></pre>

<h3>
<a name="rails" class="anchor" href="#rails"><span class="octicon octicon-link"></span></a>Rails</h3>

<p><strong>Note: kibana-rails is coming soon!</strong></p>

<p>Create an initializer at <code>config/initializers/kibana.rb</code> to configure kibana-rack:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Kibana</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">elasticsearch_host</span> <span class="o">=</span> <span class="s1">'localhost'</span>
  <span class="n">config</span><span class="o">.</span><span class="n">elasticsearch_port</span> <span class="o">=</span> <span class="mi">9200</span>
  <span class="n">config</span><span class="o">.</span><span class="n">kibana_dashboards_path</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'app/kibana'</span><span class="p">)</span>
  <span class="n">config</span><span class="o">.</span><span class="n">kibana_default_route</span> <span class="o">=</span> <span class="s1">'/dashboard/file/default.json'</span>
  <span class="n">config</span><span class="o">.</span><span class="n">kibana_index</span> <span class="o">=</span> <span class="s1">'kibana-int'</span>
<span class="k">end</span>
</pre></div>

<p>Modify <code>config/routes.rb</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">mount</span> <span class="no">Kibana</span><span class="o">::</span><span class="no">Rack</span><span class="o">::</span><span class="no">Web</span> <span class="o">=&gt;</span> <span class="s1">'/kibana'</span>
<span class="k">end</span>
</pre></div>

<h3>
<a name="sinatra-and-other-rack-applications" class="anchor" href="#sinatra-and-other-rack-applications"><span class="octicon octicon-link"></span></a>Sinatra and other Rack applications</h3>

<p>Configure kibana-rack:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Kibana</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">elasticsearch_host</span> <span class="o">=</span> <span class="s1">'localhost'</span>
  <span class="n">config</span><span class="o">.</span><span class="n">elasticsearch_port</span> <span class="o">=</span> <span class="mi">9200</span>
  <span class="n">config</span><span class="o">.</span><span class="n">kibana_dashboards_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">'../path/to/dashboards'</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
  <span class="n">config</span><span class="o">.</span><span class="n">kibana_default_route</span> <span class="o">=</span> <span class="s1">'/dashboard/file/default.json'</span>
  <span class="n">config</span><span class="o">.</span><span class="n">kibana_index</span> <span class="o">=</span> <span class="s1">'kibana-int'</span>
<span class="k">end</span>
</pre></div>

<p>Mount kibana-rack with <a href="http://rubydoc.info/github/rack/rack/master/Rack/Builder">Rack::Builder</a>:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">MyRackApplication</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">end</span>

<span class="n">app</span> <span class="o">=</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Builder</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
  <span class="n">map</span><span class="p">(</span><span class="s1">'/kibana'</span><span class="p">)</span> <span class="p">{</span> <span class="n">use</span> <span class="no">Kibana</span><span class="o">::</span><span class="no">Rack</span><span class="o">::</span><span class="no">Web</span> <span class="p">}</span>
  <span class="n">run</span> <span class="no">MyRackApplication</span>
<span class="k">end</span>

<span class="n">run</span> <span class="n">app</span>
</pre></div>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>See the <a href="http://www.elasticsearch.org/guide/en/kibana/current/index.html">Kibana documentation</a> for information on how to use Kibana.</p>

<h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>kibana-rack is configured by default to serve the dashboards that come in the gem (see the <a href="https://github.com/tabolario/kibana-rack/tree/master/dashboards">dashboards</a> directory), and proxy to Elasticsearch on <code>localhost:9200</code>. It is recommended that you maintain your own dashboards directory inside of the application that kibana-rack is mounted in. Production deployments will also most likely need to configure the address of Elasticsearch.</p>

<p>The following settings are available as accessors on the object yielded to from <code>Kibana.configure</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Kibana</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">elasticsearch_host</span> <span class="o">=</span> <span class="s1">'10.0.8.9'</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">end</span>
</pre></div>

<table>
<thead><tr>
<th>Name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>elasticsearch_host</code></td>
<td>The host of the Elasticsearch instance to proxy to. Default: <code>localhost</code>
</td>
</tr>
<tr>
<td><code>elasticsearch_port</code></td>
<td>The port of the Elasticsearch instance to proxy to. Default: <code>9200</code>
</td>
</tr>
<tr>
<td><code>kibana_dashboards_path</code></td>
<td>The directory to look for dashboards in. Default: <code>dashboards</code> directory inside of kibana-rack</td>
</tr>
<tr>
<td><code>kibana_default_route</code></td>
<td>The default path that Kibana will load. Default: <code>/dashboard/file/default.json</code>
</td>
</tr>
<tr>
<td><code>kibana_index</code></td>
<td>The name of the Elasticsearch index Kibana will use for internal storage. Default: <code>kibana-int</code>
</td>
</tr>
</tbody>
</table><h2>
<a name="securing-the-kibana-endpoint" class="anchor" href="#securing-the-kibana-endpoint"><span class="octicon octicon-link"></span></a>Securing the <code>/kibana</code> endpoint</h2>

<p>Kibana is very useful to have in production for things like searching logs and exploring Elasticsearch indexes. When using kibana-rack in a production environment, be sure to secure it from unauthorized access.</p>

<h3>
<a name="devise" class="anchor" href="#devise"><span class="octicon octicon-link"></span></a>Devise</h3>

<p>In <code>config/routes.rb</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="n">authenticate</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">mount</span> <span class="no">Kibana</span><span class="o">::</span><span class="no">Rack</span><span class="o">::</span><span class="no">Web</span> <span class="o">=&gt;</span> <span class="s1">'/kibana'</span>
<span class="k">end</span>
</pre></div>

<p>Or authenticate only if <code>User#admin?</code> returns true for <code>current_user</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="n">authenticate</span> <span class="ss">:user</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="p">{</span> <span class="n">user</span><span class="o">.</span><span class="n">admin?</span> <span class="p">}</span> <span class="k">do</span>
  <span class="n">mount</span> <span class="no">Kibana</span><span class="o">::</span><span class="no">Rack</span><span class="o">::</span><span class="no">Web</span> <span class="o">=&gt;</span> <span class="s1">'/kibana'</span>
<span class="k">end</span>
</pre></div>

<h3>
<a name="rack-with-http-basic-authentication" class="anchor" href="#rack-with-http-basic-authentication"><span class="octicon octicon-link"></span></a>Rack with HTTP basic authentication</h3>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'kibana/rack'</span>

<span class="n">map</span> <span class="s1">'/kibana'</span> <span class="k">do</span>
  <span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Auth</span><span class="o">::</span><span class="no">Basic</span><span class="p">,</span> <span class="s1">'Restricted Access'</span> <span class="k">do</span> <span class="o">|</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">|</span>
    <span class="n">username</span> <span class="o">==</span> <span class="s1">'kibana'</span> <span class="o">&amp;&amp;</span> <span class="n">password</span> <span class="o">==</span> <span class="s1">'kibana'</span>
  <span class="k">end</span>

  <span class="n">run</span> <span class="no">Kibana</span><span class="o">::</span><span class="no">Rack</span><span class="o">::</span><span class="no">Web</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="documentation" class="anchor" href="#documentation"><span class="octicon octicon-link"></span></a>Documentation</h2>

<p>See the <a href="https://github.com/tabolario/kibana-rack/tree/master/examples">examples</a> directory for installation and configuration examples.</p>

<p>See the <a href="http://rdoc.info/github/tabolario/kibana-rack">YARD documentation</a> for the latest API documentation.</p>

<p>Generate local documentation with YARD (output to the <code>doc</code> directory):</p>

<pre><code>$ bundle exec rake yard
</code></pre>

<h2>
<a name="support" class="anchor" href="#support"><span class="octicon octicon-link"></span></a>Support</h2>

<ul>
<li><a href="https://github.com/tabolario/kibana-rack/issues">GitHub Issues</a></li>
<li>Email: <a href="mailto:tony@tabolario.com">tony@tabolario.com</a>
</li>
<li>Twitter: <a href="https://twitter.com/tabolario">@tabolario</a>
</li>
</ul><h2>
<a name="development-and-testing" class="anchor" href="#development-and-testing"><span class="octicon octicon-link"></span></a>Development and testing</h2>

<p>kibana-rack follows the <a href="https://github.com/bbatsov/ruby-style-guide">Ruby Style Guide</a> for style conventions, with a few exceptions. See <a href="https://github.com/tabolario/kibana-rack/blob/master/.rubocop.yml">.rubocop.yml</a> for the details.</p>

<p>Run linters (<a href="https://github.com/bbatsov/rubocop">RuboCop</a> and <a href="https://github.com/rrrene/inch">Inch</a>):</p>

<pre><code>$ bundle exec rake lint
</code></pre>

<p>Run tests:</p>

<pre><code>$ bundle exec rake spec
</code></pre>

<p>Install pre-commit hooks for <a href="https://github.com/causes/overcommit">overcommit</a> (configuration is in <a href="https://github.com/tabolario/kibana-rack/blob/master/.overcommit.yml">.overcommit.yml</a>):</p>

<pre><code>$ gem install overcommit
$ overcommit --install
</code></pre>

<h2>
<a name="security" class="anchor" href="#security"><span class="octicon octicon-link"></span></a>Security</h2>

<h3>
<a name="installation-1" class="anchor" href="#installation-1"><span class="octicon octicon-link"></span></a>Installation</h3>

<p>kibana-rack is cryptographically signed. To be sure the gem you install hasn't been tampered with, add my public key (if you haven't already) as a trusted certificate:</p>

<pre><code>$ gem cert --add &lt;(curl -Ls https://raw.github.com/tabolario/kibana-rack/master/tabolario.pem)
</code></pre>

<p>Installing the gem with the MediumSecurity trust profile will verify all signed gems, but allow the installation of unsigned dependencies:</p>

<pre><code>$ gem install kibana-rack -P MediumSecurity
</code></pre>

<p>You can also set the trust file for Bundler:</p>

<pre><code>$ bundle --trust-policy MediumSecurity
</code></pre>

<p>Using the MediumSecurity policy is often necessary because not all of your dependencies may not be signed, so HighSecurity is not an option.</p>

<h3>
<a name="reporting-security-issues" class="anchor" href="#reporting-security-issues"><span class="octicon octicon-link"></span></a>Reporting Security Issues</h3>

<p>If you have discovered an issue with kibana-rack of a sensitive nature that could compromise the security of kibana-rack users, <strong>please report it securely by sending a GPG-encrypted message instead of filing an issue on GitHub</strong>. Please use the following key and send your report to <a href="mailto:tony@tabolario.com">tony@tabolario.com</a>.</p>

<p><a href="https://raw.github.com/tabolario/kibana-rack/tabolario.gpg">https://raw.github.com/tabolario/kibana-rack/tabolario.gpg</a></p>

<p>The fingerprint of the key should be:</p>

<pre><code>6EED 2359 968F 7734 06A4 AB56 D90E 487A 60F1 0579
</code></pre>

<h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>See <a href="https://github.com/tabolario/kibana-rack/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a> for full information on how to contribute to kibana-rack.</p>

<h2>
<a name="release-process" class="anchor" href="#release-process"><span class="octicon octicon-link"></span></a>Release process</h2>

<p>kibana-rack follows <a href="http://semver.org/spec/v2.0.0.html">Semver 2.0.0</a> for release versioning. The version number components X.Y.Z have the following meanings:</p>

<ul>
<li>X for <strong>Major</strong> releases that may contain backwards-incompatible changes.</li>
<li>Y for <strong>Minor</strong> releases that may contain features, bug fixes, and backwards-compatible changes.</li>
<li>Z for <strong>Patch</strong> releases that only contain bug fixes and trivial changes.</li>
</ul><p><strong>Pre-release</strong> versions like <code>X.Y.Z.alpha.0</code> and <code>X.Y.Z.beta.1</code> will be made before <strong>Major</strong>, and <strong>Minor</strong> versions. Pre-release versions are well-tested, but not as thoroughly as the versions that they precede.</p>

<p>Whenever a new version is made, it will be tagged as a release on <a href="https://github.com/tabolario/kibana-rack/releases">GitHub Releases</a> and pushed to <a href="https://rubygems.org/gems/kibana-rack">RubyGems</a>. Entries in <a href="https://github.com/tabolario/kibana-rack/blob/master/CHANGELOG.md">CHANGELOG.md</a> will be made incrementally up to the release. An announcement will also be made on Twitter.</p>

<p>When a new <strong>Major</strong> version is made, a corresponding branch will be created named <code>X-0-0</code> for further <strong>Minor</strong> and <strong>Patch</strong> releases on that version.</p>

<h2>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>Todo</h2>

<p>See the <a href="https://github.com/tabolario/kibana-rack/issues?q=is%3Aopen+is%3Aissue+label%3Atodo">issue tracker</a> for the current list of todos.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<h3>
<a name="kibana-rack" class="anchor" href="#kibana-rack"><span class="octicon octicon-link"></span></a>kibana-rack</h3>

<table>
<thead><tr>
<th></th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td><strong>Author</strong></td>
<td>Tony Burns &lt;<a href="mailto:tony@tabolario.com">tony@tabolario.com</a>&gt;</td>
</tr>
<tr>
<td><strong>Copyright</strong></td>
<td>Copyright (c) 2014 Tony Burns</td>
</tr>
<tr>
<td><strong>License</strong></td>
<td><a href="http://opensource.org/licenses/MIT">MIT License</a></td>
</tr>
</tbody>
</table><div class="highlight highlight-text"><pre>MIT License

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</pre></div>

<h3>
<a name="kibana" class="anchor" href="#kibana"><span class="octicon octicon-link"></span></a>Kibana</h3>

<table>
<thead><tr>
<th></th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td><strong>Copyright</strong></td>
<td>Copyright 2012-2013 Elasticsearch BV</td>
</tr>
<tr>
<td><strong>License</strong></td>
<td><a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a></td>
</tr>
</tbody>
</table>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
